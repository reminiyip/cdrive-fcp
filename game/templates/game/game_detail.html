{% extends 'game/base.html' %}
{% load staticfiles %}

{% block title %}Game - {{ game.title }}{% endblock %}
{% block children_css %}<link rel="stylesheet" href="{% static 'css/game.css' %}">{% endblock %}

{% block content %}

<div id="game-page" class="container-fluid">
	
	<div id="game-info-header">	

		{% include "includes/breadcrumb.html" with layers=layers %}

		<div class="page-header">
			<h3>{{ game.title }}</h3>
			<div id="add-to-cart" >
				<h3><small>Buy <span class="game-name">{{ game.title }}</span> at <span class="label label-info price">HK$ {{ game.price }}</span></small></h3>
				{% if not user.is_authenticated %}
					<a class="btn btn-default btn-md" role="button" href="{% url 'login' %}">Login to purchase
				{% elif user.is_authenticated and game in user.profile.get_purchased_games %}
					<a class="btn btn-default btn-md disabled" role="button" href="{% url 'add_to_cart' game.genre_id game.id %}">Thanks for purchasing!
				{% elif game in user.profile.get_active_cart.game.all %}
					<a class="btn btn-default btn-md disabled" role="button" href="{% url 'add_to_cart' game.genre_id game.id %}">Added to Cart
				{% else %}
					<a class="btn btn-default btn-md" role="button" href="{% url 'add_to_cart' game.genre_id game.id %}">Add to Cart
				{% endif %}
				</a>
			</div>
		</div>
	</div>

	<div class="row">

		<div class="col-md-6">
			<div id="game-info-left">	
				<div id="game-image">
					<img src="{{ game.image.url }}" class="img-thumbnail img-responsive center-block game-image" />
				</div>
			</div>
		</div>

		<div class="col-md-6">
			<div id="game-info-right">
				<div class="well">
					<p>{{ game.full_description }}</p>
				</div>
				<div id="tags">
					<div id="tag-list">
						{% for tag in game.get_sorted_tags %}
							<a class="btn btn-warning" href="{% url 'tagged_games' tag.tag_name %}">
								{{ tag.tag_name }} <span class="badge">{{ tag.popularity }}</span>
							</a>
						{% endfor %}
					</div>
					{% if user.is_authenticated and game in user.profile.get_purchased_games %}
						<div>
							<form method="POST" action="{% url 'add_tag' game.genre.id game.id %}" class="form-inline">{% csrf_token %} 
								<div class="form-group">
									<input type="text" class="form-control" id="tag-input" placeholder="New tag" name="tag_name" />
								</div>
								<button type="submit" class="btn btn-default">Submit</button>					
							</form>
						</div>
					{% endif %}
				</div>
			</div>
		</div>

	</div>

</div>

{% endblock %}
